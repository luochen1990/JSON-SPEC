{"version":3,"sources":["prim/oneof.coffee"],"names":[],"mappings":"AAAA;AAAA,MAAA;;EAAA,OAAA,CAAQ,oBAAR;;EACC,WAAY,OAAA,CAAQ,cAAR,EAAZ;;EACD,MAA4E,OAAA,CAAQ,aAAR,CAA5E,EAAC,YAAA,KAAD,EAAQ,YAAA,KAAR,EAAe,kBAAA,WAAf,EAA4B,WAAA,IAA5B,EAAkC,cAAA,OAAlC,EAA2C,aAAA,MAA3C,EAAmD,iBAAA,UAAnD,EAA+D,gBAAA;;EAC/D,OAA6B,OAAA,CAAQ,YAAR,CAA7B,EAAC,oBAAA,YAAD,EAAe,kBAAA;;EAET;IACQ,eAAC,KAAD;MACZ,IAAA,CAAA,CAAO,eAAA,IAAW,KAAK,CAAC,WAAN,KAAqB,KAAvC,CAAA;AACC,cAAM,KAAA,CAAM,qDAAA,GAAsD,KAA5D,EADP;;MAEA,IAAA,CAAO,GAAA,CAAI,UAAJ,CAAA,CAAgB,KAAhB,CAAP;AACC,cAAM,KAAA,CAAM,iEAAA,GAAkE,KAAxE,EADP;;MAGA,GAAA,CAAI,SAAA;eAAG,KAAK,CAAC,GAAN,CAAU,IAAV;MAAH,CAAJ;AACA,aAAO;QACN,WAAA,EAAa,KADP;QAEN,KAAA,EAAO,KAFD;;IAPK;;;;;;EAYd,QAAA,CAAS,UAAT,CAAA,CAAqB,KAArB,CAA2B,CAAC,KAA5B,CACC;IAAA,KAAA,EAAO,SAAC,GAAD;AACN,UAAA;MADQ,QAAD,IAAC;MACR,MAAA,GAAS,GAAA,CAAI,GAAA,CAAI,KAAJ,CAAA,CAAW,KAAX,CAAJ,EAAuB,KAAvB;aACT,SAAC,CAAD;AACC,YAAA;QAAA,aAAA,GAAgB,MAAA,CAAO,SAAC,IAAD;AAAa,cAAA;UAAX,cAAI;iBAAO,KAAA,CAAM,EAAN,CAAA,CAAU,CAAV;QAAb,CAAP,CAAA,CAAkC,MAAlC;AAGhB,eAAO,MAAA,CAAO,IAAA,CAAK,CAAL,CAAA,CAAQ,aAAR,CAAP,CAAA,KAAiC,CAAjC,IAAuC,KAAA,CAAM,IAAA,CAAK,aAAL,CAAoB,CAAA,CAAA,CAA1B,CAAA,CAA8B,CAA9B;MAJ/C;IAFM,CAAP;IAOA,WAAA,EAAa,SAAC,GAAD;AACZ,UAAA;MADc,QAAD,IAAC;MACd,MAAA,GAAS,GAAA,CAAI,GAAA,CAAI,KAAJ,CAAA,CAAW,KAAX,CAAJ,EAAuB,KAAvB;aACT,SAAC,CAAD;AACC,YAAA;QAAA,aAAA,GAAgB,MAAA,CAAO,SAAC,IAAD;AAAa,cAAA;UAAX,cAAI;iBAAO,KAAA,CAAM,EAAN,CAAA,CAAU,CAAV;QAAb,CAAP,CAAA,CAAkC,MAAlC;QAChB,YAAA,GAAe,MAAA,CAAO,IAAA,CAAK,CAAL,CAAA,CAAQ,aAAR,CAAP;AACf,eAAO;UACN;YACC,KAAA,EAAO,SAAA;qBAAG,QAAA,GAAQ,CAAC,IAAA,CAAK,GAAA,CAAI,IAAJ,CAAA,CAAU,GAAA,CAAI,KAAA,CAAM,CAAN,CAAJ,CAAA,CAAa,MAAb,CAAV,CAAL,CAAmC,CAAC,IAApC,CAAyC,KAAzC,CAAD,CAAR,GAAyD,qBAAzD,GAA8E;YAAjF,CADR;YAEC,IAAA,EAAM,SAAA;qBAAG,YAAA,GAAe;YAAlB,CAFP;WADM,EAKN;YACC,KAAA,EAAO,SAAA;qBAAG,kBAAA,GAAkB,CAAC,IAAA,CAAK,GAAA,CAAI,IAAJ,CAAA,CAAU,GAAA,CAAI,KAAA,CAAM,CAAN,CAAJ,CAAA,CAAa,aAAb,CAAV,CAAL,CAA0C,CAAC,IAA3C,CAAgD,KAAhD,CAAD,CAAlB,GAA0E,gBAA1E,GAAyF,CAAC,IAAA,CAAK,CAAL,CAAD;YAA5F,CADR;YAEC,IAAA,EAAM,SAAA;qBAAG,YAAA,GAAe;YAAlB,CAFP;WALM,EASN;YACC,KAAA,EAAO,SAAA;qBAAG,QAAA,GAAQ,CAAC,IAAA,CAAK,IAAA,CAAK,aAAL,CAAoB,CAAA,CAAA,CAAzB,CAAD;YAAX,CADR;YAEC,GAAA,EAAK,SAAA;qBAAG,WAAA,CAAY,IAAA,CAAK,aAAL,CAAoB,CAAA,CAAA,CAAhC,CAAA,CAAoC,CAApC;YAAH,CAFN;WATM;;MAHR;IAFY,CAPb;IA0BA,IAAA,EAAM,SAAC,GAAD;AACL,UAAA;MADO,QAAD,IAAC;aACP,GAAA,GAAG,CAAC,CAAC,IAAA,CAAK,GAAA,CAAI,IAAJ,CAAA,CAAU,KAAV,CAAL,CAAD,CAAsB,CAAC,IAAvB,CAA4B,KAA5B,CAAD,CAAH,GAAuC;IADlC,CA1BN;IA4BA,OAAA,EAAS,SAAC,GAAD;AACR,UAAA;MADU,QAAD,IAAC;aACV,MAAA,CAAO,MAAA,CAAO,GAAA,CAAI,MAAJ,CAAA,CAAY,KAAZ,CAAP,CAAP;IADQ,CA5BT;IA8BA,UAAA,EAAY,SAAC,GAAD;AACX,UAAA;MADa,QAAD,IAAC;aACb,qCAAA,GAAqC,CAAC,CAAC,IAAA,CAAK,GAAA,CAAI,UAAJ,CAAA,CAAgB,KAAhB,CAAL,CAAD,CAA4B,CAAC,IAA7B,CAAkC,KAAlC,CAAD,CAArC,GAA+E;IADpE,CA9BZ;IAgCA,SAAA,EAAW,SAAC,GAAD;AAEV,UAAA;MAFY,QAAD,IAAC;aAEZ;QAAA,IAAA,EAAM,yCAAN;QACA,IAAA,EAAM,YAAA,CAAa,OAAb,EAAsB,YAAtB,CAAA,CAAoC,IAAA,CAAK,IAAA,CAAK,GAAA,CAAI,QAAJ,EAAc,KAAd,CAAL,CAAL,CAApC,CADN;QAEA,IAAA,EAAM,mCAFN;;IAFU,CAhCX;GADD;;EAuCA,MAAM,CAAC,OAAP,GAAiB;IAAC,OAAA,KAAD;;AAzDjB","file":"prim/oneof.js","sourceRoot":"/source/","sourcesContent":["require 'coffee-mate/global'\n{instance} = require '../typeclass'\n{shape, match, constraints, show, samples, sample, htmlInline, htmlBlock} = require '../typespec'\n{genBlockBody, isTypeSpec} = require '../helpers'\n\nclass OneOf\n\tconstructor: (specs) ->\n\t\tunless specs? and specs.constructor is Array\n\t\t\tthrow Error \"Bad OneOf Type Definition: Array Expected, But Got #{specs}\"\n\t\tunless all(isTypeSpec)(specs)\n\t\t\tthrow Error \"Bad OneOf Type Definition: Array of TypeSpec Expected, But Got #{specs}\"\n\n\t\tlog -> specs.map(show)\n\t\treturn {\n\t\t\tconstructor: OneOf\n\t\t\tspecs: specs\n\t\t}\n\ninstance('TypeSpec')(OneOf).where\n\tmatch: ({specs}) ->\n\t\tshaped = zip(map(shape)(specs), specs)\n\t\t(v) ->\n\t\t\tmatchedShapes = filter(([sh, _]) -> match(sh)(v)) shaped\n\t\t\t#log -> specs.map(show)\n\t\t\t#log -> list(matchedShapes).map(show)\n\t\t\treturn length(take(2) matchedShapes) == 1 and match(head(matchedShapes)[1])(v)\n\tconstraints: ({specs}) ->\n\t\tshaped = zip(map(shape)(specs), specs)\n\t\t(v) ->\n\t\t\tmatchedShapes = filter(([sh, _]) -> match(sh)(v)) shaped\n\t\t\tmatchedCount = length(take(2) matchedShapes)\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tlabel: -> \"Shape #{list(map(show) map(pluck 0) shaped).join(' | ')} Expected, But Got #{v}\"\n\t\t\t\t\tflag: -> matchedCount > 0\n\t\t\t\t}\n\t\t\t\t{\n\t\t\t\t\tlabel: -> \"Ambiguous Shape #{list(map(show) map(pluck 0) matchedShapes).join(' | ')} Matched, Got #{json v}\"\n\t\t\t\t\tflag: -> matchedCount < 2\n\t\t\t\t}\n\t\t\t\t{\n\t\t\t\t\tlabel: -> \"Shape #{show(head(matchedShapes)[0])}\"\n\t\t\t\t\tsub: -> constraints(head(matchedShapes)[1])(v)\n\t\t\t\t}\n\t\t\t]\n\tshow: ({specs}) ->\n\t\t\"(#{(list map(show) specs).join(' | ')})\"\n\tsamples: ({specs}) ->\n\t\tconcat repeat map(sample)(specs)\n\thtmlInline: ({specs}) ->\n\t\t\"<span class='type-maker unwrapped'>#{(list map(htmlInline) specs).join(' | ')}</span>\"\n\thtmlBlock: ({specs}) ->\n\t\t#log -> (list zip(repeat('-'), specs))\n\t\thead: \"<span class='type-maker'>OneOf [</span>\"\n\t\tbody: genBlockBody('OneOf', 'meta-field')(dict list zip(naturals, specs))\n\t\ttail: \"<span class='type-maker'>]</span>\"\n\nmodule.exports = {OneOf}\n\n"]}